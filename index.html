<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Drift Arcade 3D</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            background: #111;
            font-family: system-ui, sans-serif;
        }

        #overlay {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 8px 12px;
            background: rgba(0,0,0,0.6);
            color: #fff;
            border-radius: 8px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="overlay">
        <b>Drift Arcade 3D</b><br>
        Steuerung: W / S = Gas / Bremse<br>
        A / D = Lenken<br>
        Space = Handbremse (mehr Drift)
    </div>

    <!-- 100% funktionierender Three.js Build -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

    <script>
        window.onload = () => {
            console.log("Three.js Revision:", THREE.REVISION);

            // === Szene ===
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87ceeb);

            const camera = new THREE.PerspectiveCamera(
                70,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.set(0, 5, 10); // Kamera VOR dem Auto


            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // === Licht ===
            const ambient = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambient);

            const dirLight = new THREE.DirectionalLight(0xffffff, 1.0);
            dirLight.position.set(10, 20, 10);
            scene.add(dirLight);

            // === Boden ===
            const groundGeo = new THREE.PlaneGeometry(200, 200);
            const groundMat = new THREE.MeshStandardMaterial({
                color: 0x3b3b3b,
                roughness: 1,
                flatShading: true
            });
            const ground = new THREE.Mesh(groundGeo, groundMat);
            ground.rotation.x = -Math.PI / 2;
            scene.add(ground);

            // === Auto ===
            const car = new THREE.Group();

            // Karosserie
            const body = new THREE.Mesh(
                new THREE.BoxGeometry(2.5, 0.7, 4),
                new THREE.MeshStandardMaterial({
                    color: 0xff4444,
                    roughness: 0.8,
                    flatShading: true
                })
            );
            body.position.y = 0.6;
            car.add(body);

            // Dach
            const roof = new THREE.Mesh(
                new THREE.BoxGeometry(1.6, 0.6, 2.0),
                new THREE.MeshStandardMaterial({
                    color: 0xffffff,
                    roughness: 0.9,
                    flatShading: true
                })
            );
            roof.position.set(0, 1.1, 0);
            car.add(roof);

            // RÃ¤der
            const wheelGeo = new THREE.CylinderGeometry(0.5, 0.5, 0.4, 10);
            const wheelMat = new THREE.MeshStandardMaterial({
                color: 0x111111,
                roughness: 1,
                flatShading: true
            });

            function addWheel(x, z) {
                const w = new THREE.Mesh(wheelGeo, wheelMat);
                w.rotation.z = Math.PI / 2;
                w.position.set(x, 0.3, z);
                car.add(w);
            }

            addWheel(-1.3, 1.5);
            addWheel(1.3, 1.5);
            addWheel(-1.3, -1.5);
            addWheel(1.3, -1.5);

            car.position.set(0, 0, 0);
            scene.add(car);

            // === Steuerung ===
            const keys = {};
            document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
            document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

            let velocity = new THREE.Vector3();
            let angle = 0;

            function update() {
                const fwd = keys['w'] || keys['arrowup'];
                const back = keys['s'] || keys['arrowdown'];
                const left = keys['a'] || keys['arrowleft'];
                const right = keys['d'] || keys['arrowright'];

                // Basic movement
                if (fwd) velocity.z -= 0.02;
                if (back) velocity.z += 0.015;

                // Rotation
                if (left) angle += 0.04;
                if (right) angle -= 0.04;

                // Apply movement
                const rot = new THREE.Quaternion();
                rot.setFromAxisAngle(new THREE.Vector3(0, 1, 0), angle);
                const moved = velocity.clone().applyQuaternion(rot);

                car.position.add(moved);
                car.rotation.y = angle;

                // friction
                velocity.multiplyScalar(0.95);
            }

            function animate() {
                requestAnimationFrame(animate);
                update();

                // Kamera schaut immer auf das Auto
                camera.lookAt(car.position.x, car.position.y + 1, car.position.z);

                renderer.render(scene, camera);
            }


            animate();

        }; // end onload
    </script>

</body>
</html>
